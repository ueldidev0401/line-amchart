<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"> 
    <style type="text/css">
      #chartdiv {
          width	: 1500;
          height	: 500px;
      }		
      .tooltip {
          display: none;
          position: absolute;
          background-color: #181717;
          color : white;
          width : 220px;
          padding: 5px;
          text-align: center;
          border-radius: 6px;
          z-index: 1;
          font-size: 12px;
          font-family: 'Courier New', Courier, monospace;
      }															
    </style>	
  </head>
    <body>
      <script src="https://www.amcharts.com/lib/3/amcharts.js"></script>
      <script src="https://www.amcharts.com/lib/3/serial.js"></script>
      <script src="https://www.amcharts.com/lib/3/plugins/export/export.min.js"></script>
      <link rel="stylesheet" href="https://www.amcharts.com/lib/3/plugins/export/export.css" type="text/css" media="all" />
      <script src="https://www.amcharts.com/lib/3/themes/light.js"></script>

      <div style="text-align: center;"> Example Graph (Ctrl + : Pan)</div>
      <div id="chartdiv"></div>	
      <div class="tooltip"></div>		

      <script>
      var visits = [25000000,255000000,85000000,30000000,120000000,225000000,60000000,210000000,215600000,13500000,40000000,265000000, 35000000,83000000,112000000,270000000,47000000,25000000,50100000,155000000 ];
      var chartData = generateChartData();
      var newDate = [];
      var newData = [];
      let ctrlFlag = false;
      var chart = AmCharts.makeChart("chartdiv", {
          "type": "serial",
          "theme": "light",
          "marginRight": 80,
          "autoMarginOffset": 20,
          "marginTop": 7,
          "dataProvider": chartData,
          "valueAxes": [{
              "axisAlpha": 0.2,
              "dashLength": 1,
              "position": "left"
          }],
          "mouseWheelZoomEnabled": true,
          "graphs": [{
              "id": "g1",
              "balloonText": "[[value]]",
              "bullet": "round",
              "bulletBorderAlpha": 1,
              "bulletColor": "#FFFFFF",
              "hideBulletsCount": 50,
              "title": "red line",
              "valueField": "visits",
              "useLineColorForBulletBorder": true,
              "balloon":{
                  "drop":true
              }
          }],
        //   "chartScrollbar": {
        //       "autoGridCount": false,
        //       "graph": "g1",
        //       "scrollbarHeight": 40
        //   },
          "chartCursor": {
            "limitToGraph":"g1",
            "cursorColor": "#f57269",
            "categoryBalloonEnabled": true,
            "cursorAlpha": 0.5,
            "fullWidth": true,
            "valueLineBalloonEnabled": true,
            "valueLineEnabled": true,
            "valueLineAlpha": 0.5,
            "valueLineBalloonEnabled": true,
            "cursorPosition" : "mouse",
            "zoomable" : true,
            "pan": false,
            "panEventsEnabled": false,
          },
          "categoryField": "date",
          "categoryAxis": {
              "parseDates": true,
              "axisColor": "#DADADA",
              "dashLength": 1,
              "minorGridEnabled": true
          },
          "export": {
              "enabled": true
          }
      });

      chart.addListener("rendered", zoomChart);
      zoomChart();

      // this method is called when chart is first inited as we listen for "rendered" event
      function zoomChart() {
          // different zoom methods can be used - zoomToIndexes, zoomToDates, zoomToCategoryValues
          chart.zoomToIndexes(chartData.length - 40, chartData.length - 1);
      }


      // generate some random data, quite different range
      function generateChartData() {
          var chartData = [];
          var firstDate = new Date();
          
          firstDate.setDate(firstDate.getDate() - 5);

          for (var i = 0; i < visits.length + 5; i++) {
              // we create date objects here. In your data, you can have date strings
              // and then set format of your dates using chart.dataDateFormat property,
              // however when possible, use date objects, as this will speed up chart rendering.
              newDate = new Date(firstDate);
              newDate.setDate(newDate.getDate() + i);

              // var visits = Math.round(Math.random() * (40 + i / 5)) + 20 + i;

              chartData.push({
                  date: newDate,
                  visits: visits[i]
              });
          }
          return chartData;
      }
      
        var chartDiv = document.getElementById("chartdiv");
        chartDiv.addEventListener("click", handleClick); 

       
        document.addEventListener("keydown", function(event) {
            // Check if the key pressed is the "Enter" key
            if (event.key === "Control") {
                // Do something when the "Enter" key is pressed
                chart.chartCursor.pan = true;
                chart.chartCursor.panEventsEnabled = true;
                chartDiv.removeEventListener('click', handleClick);
            }
        });
        document.addEventListener("keyup", function(event) {
            if (event.key === "Control") {
                // Do something when the "Enter" key is pressed
                chart.chartCursor.pan = false;
                chart.chartCursor.panEventsEnabled = false;
                chartDiv.addEventListener("click", handleClick); 
            }
        });
        function handleClick(event) {
            console.log("event = ", event);
            var mouseX = event.clientX - chart.marginRight + chart.autoMarginOffset;
            var mouseY = event.clientY;
            var chartLeft = chartDiv.getBoundingClientRect().left;
            var chartTop = chartDiv.getBoundingClientRect().top;
            var chartWidth = chartDiv.offsetWidth;
            var valueAxes = chart.valueAxes;
            var availableXdate = chartData[chartData.length - 4].date;
            var xAxis = chart.categoryAxis;
            var availableX = Math.floor(xAxis.dateToCoordinate(availableXdate));
            var availableY = null;

            for (var i = 0; i < valueAxes.length; i++) {
                var axis = valueAxes[i];
                var coordinateY = parseInt(axis.coordinateToValue((mouseY - chartTop - axis.offset)));
            console.log("availableX = ", availableX, "mouseX = ", mouseX, "chartLeft = ", chartLeft, "axis.offset = ", axis.offset, "chartWidth = ", chartWidth);

                if (coordinateY !== undefined) {
                    availableY = coordinateY;
                    break;
                }
            }
            if(mouseX - 10 <= availableX && mouseX + 10 >= availableX) {
                visits.push(availableY);
                chartData = generateChartData();
                chart.dataProvider = chartData;
                chart.validateData();
            }
        }
      </script>
    </body>
</html>
